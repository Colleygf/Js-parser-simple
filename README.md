\# JavaScript è¯­æ³•è§£æå™¨



ä¸€ä¸ªåŸºäº \*\*C è¯­è¨€\*\* çš„ JavaScript è¯­æ³•è§£æå™¨ï¼Œä½¿ç”¨ \*\*re2c\*\* å’Œ \*\*bison\*\* æ„å»ºï¼Œæ”¯æŒ \*\*è‡ªåŠ¨åˆ†å·æ’å…¥ï¼ˆASIï¼‰æœºåˆ¶\*\*ã€‚



---



\## ğŸš€ é¡¹ç›®ç‰¹æ€§



\* âœ… å®Œæ•´çš„ JavaScript è¯­æ³•è§£æ

\* âœ… è‡ªåŠ¨åˆ†å·æ’å…¥ï¼ˆASIï¼‰æœºåˆ¶

\* âœ… æ”¯æŒ ECMAScript åŸºæœ¬è¯­æ³•ç»“æ„

\* âœ… è¯¦ç»†çš„è¯­æ³•é”™è¯¯æŠ¥å‘Š

\* âœ… ä¸°å¯Œçš„æµ‹è¯•ç”¨ä¾‹è¦†ç›–



---



\## ğŸ§© æ”¯æŒçš„è¯­è¨€ç‰¹æ€§



\### å˜é‡å£°æ˜



```javascript

var x = 10;

let y = 20;

const z = 30;

```



\### å‡½æ•°



```javascript

function add(a, b) {

&nbsp;   return a + b;

}

```



\### æ§åˆ¶æµ



```javascript

if (condition) { /\* ... \*/ } else { /\* ... \*/ }

while (condition) { /\* ... \*/ }

for (let i = 0; i < 10; i++) { /\* ... \*/ }

```



\### è¡¨è¾¾å¼



```javascript

x + y \* z

x > 5 ? "greater" : "less"

x === y \&\& y !== z

```



\### ASI æœºåˆ¶



```javascript

// è‡ªåŠ¨åˆ†å·æ’å…¥

var a = 1

var b = 2

console.log("Hello")

```



---



\## ğŸ“ é¡¹ç›®ç»“æ„



```text

js-parser/

â”œâ”€â”€ lexer.l           # re2c è¯æ³•åˆ†æå™¨

â”œâ”€â”€ parser.y          # bison è¯­æ³•åˆ†æå™¨

â”œâ”€â”€ main.c            # ä¸»ç¨‹åº

â”œâ”€â”€ common.h          # å…¬å…±ç±»å‹å®šä¹‰

â”œâ”€â”€ test\_files/       # æµ‹è¯•ç”¨ä¾‹ç›®å½•

â”‚   â”œâ”€â”€ simple.js

â”‚   â”œâ”€â”€ asi\_test.js

â”‚   â”œâ”€â”€ error.js

â”œâ”€â”€ Makefile          # æ„å»ºé…ç½®

```



---



\## âš™ï¸ æ„å»ºè¦æ±‚



\### ç³»ç»Ÿè¦æ±‚



\* Linuxï¼ˆæ¨èä½¿ç”¨ WSL / Ubuntuï¼‰

\* gcc ç¼–è¯‘å™¨

\* make æ„å»ºå·¥å…·



\### ä¾èµ–å·¥å…·å®‰è£…



```bash

sudo apt update

sudo apt install re2c bison build-essential

```



---



\## ğŸ§± æ„å»ºä¸å®‰è£…



\### æ‰‹åŠ¨æ„å»º



```bash

\# ç”Ÿæˆè¯æ³•åˆ†æå™¨

re2c -o lexer.c lexer.l



\# ç”Ÿæˆè¯­æ³•åˆ†æå™¨

bison -d -o parser.c parser.y



\# ç¼–è¯‘å¯æ‰§è¡Œæ–‡ä»¶

gcc -Wall -Wextra -g -o js-parser main.c lexer.c parser.c -lm

```



\### å¿«é€Ÿæ„å»ºï¼ˆæ¨èï¼‰



```bash

make clean

make

```



---



\## ğŸ’¡ ä½¿ç”¨æ–¹æ³•



\### åŸºæœ¬ç”¨æ³•



```bash

./js-parser <javascriptæ–‡ä»¶>

```



\### ç¤ºä¾‹



```bash

\# è§£æå•ä¸ªæ–‡ä»¶

./js-parser test.js



\# è§£ææµ‹è¯•ç”¨ä¾‹

./js-parser test\_files/simple.js



\# æ‰‹åŠ¨è¿è¡Œç‰¹å®šæµ‹è¯•

./js-parser test\_files/asi\_test.js

./js-parser test\_files/error.js

```



---



\## ğŸ§¾ è¾“å‡ºè¯´æ˜



\### æˆåŠŸè§£æ



```text

Parsing JavaScript file: example.js

âœ“ Syntax is valid

```



\### è¯­æ³•é”™è¯¯



```text

Parsing JavaScript file: example.js

PARSER: Syntax error: syntax error

PARSER: At position: 25

PARSER: Context: 'var x = 10 let y = 20'

PARSER:                     ^

âœ— Syntax errors found

```



\### è°ƒè¯•ä¿¡æ¯



å¯ç”¨è°ƒè¯•è¾“å‡ºå¯ä»¥æŸ¥çœ‹è¯¦ç»†è§£æè¿‡ç¨‹ï¼š



```text

LEXER: Token VAR at position 3

LEXER: Token IDENTIFIER ('x') at position 5

PARSER: Parsed variable declaration

PARSER: ASI - Automatically inserted semicolon after statement

```



---



\## âš™ï¸ æŠ€æœ¯ç»†èŠ‚



\### è¯æ³•åˆ†æå™¨ï¼ˆ`lexer.l`ï¼‰



\* ä½¿ç”¨ \*\*re2c\*\* ç”Ÿæˆé«˜æ•ˆçš„è¯æ³•åˆ†æå™¨

\* æ”¯æŒ Unicode å­—ç¬¦

\* å¤„ç†æ³¨é‡Šã€å­—ç¬¦ä¸²ã€æ•°å­—å­—é¢é‡

\* è¯†åˆ« JavaScript å…³é”®å­—å’Œè¿ç®—ç¬¦



\### è¯­æ³•åˆ†æå™¨ï¼ˆ`parser.y`ï¼‰



\* ä½¿ç”¨ \*\*bison\*\* ç”Ÿæˆ LALR è¯­æ³•åˆ†æå™¨

\* å®ç°å®Œæ•´çš„è¡¨è¾¾å¼ä¼˜å…ˆçº§ä¸ç»“åˆæ€§

\* æ”¯æŒè‡ªåŠ¨åˆ†å·æ’å…¥æœºåˆ¶

\* æä¾›è¯¦ç»†çš„é”™è¯¯æ¢å¤ä¸æŠ¥å‘Š



\### ASI å®ç°è§„åˆ™



æ ¹æ® ECMAScript è§„èŒƒï¼Œè‡ªåŠ¨æ’å…¥åˆ†å·çš„æƒ…å†µåŒ…æ‹¬ï¼š



1\. è¡Œç»“æŸç¬¦åä¸”è¯­æ³•ä¸å…è®¸ç»§ç»­æ—¶

2\. `}` ç¬¦å·å‰

3\. ç¨‹åºç»“æŸæ—¶



---



\## ğŸ§ª æµ‹è¯•è¦†ç›–



é¡¹ç›®åŒ…å«å…¨é¢çš„æµ‹è¯•ç”¨ä¾‹ï¼š



\* \*\*åŸºç¡€è¯­æ³•\*\*ï¼šå˜é‡ã€å‡½æ•°ã€æ§åˆ¶æµ

\* \*\*ASI åœºæ™¯\*\*ï¼šå„ç§åˆ†å·çœç•¥æƒ…å†µ

\* \*\*é”™è¯¯æƒ…å†µ\*\*ï¼šè¯­æ³•é”™è¯¯æ£€æµ‹



---



\## âš ï¸ é™åˆ¶ä¸æ³¨æ„äº‹é¡¹



\* å½“å‰ç‰ˆæœ¬ä¸æ„å»ºå®Œæ•´çš„ ASTï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰

\* ä¸“æ³¨äºè¯­æ³•éªŒè¯è€Œéä»£ç æ‰§è¡Œ

\* æŸäº›é«˜çº§ ES6+ ç‰¹æ€§æš‚ä¸æ”¯æŒ

\* é”™è¯¯æ¢å¤æœºåˆ¶è¾ƒä¸ºåŸºç¡€



---



\## ğŸ§­ å¼€å‘æŒ‡å—



\### æ·»åŠ æ–°çš„è¯­æ³•ç‰¹æ€§



1\. åœ¨ `lexer.l` ä¸­æ·»åŠ æ–°çš„è¯æ³•è§„åˆ™

2\. åœ¨ `parser.y` ä¸­æ·»åŠ å¯¹åº”è¯­æ³•è§„åˆ™

3\. æ›´æ–°ä¼˜å…ˆçº§å’Œç»“åˆæ€§å®šä¹‰

4\. æ·»åŠ æµ‹è¯•ç”¨ä¾‹

5\. è¿è¡Œæµ‹è¯•éªŒè¯



\### è°ƒè¯•æŠ€å·§



\* ä½¿ç”¨ `make clean \&\& make` é‡æ–°æ„å»º

\* æŸ¥çœ‹è¯¦ç»†çš„ LEXER å’Œ PARSER è¾“å‡º

\* ä½¿ç”¨ `-g` ç¼–è¯‘å¯ç”¨è°ƒè¯•ä¿¡æ¯

\* æ£€æŸ¥ bison çš„å†²çªè­¦å‘Š



---



\## ğŸ“œ è®¸å¯è¯



æœ¬é¡¹ç›®ä»…ç”¨äºæ•™è‚²ä¸å­¦ä¹ ç›®çš„ã€‚



---



\## ğŸ¤ è´¡çŒ®



æ¬¢è¿æäº¤ \*\*Issue\*\* æˆ– \*\*Pull Request\*\* æ¥æ”¹è¿›æœ¬è§£æå™¨ã€‚



---



\## ğŸ”— ç›¸å…³èµ„æº



\* \[ECMAScript è§„èŒƒ](https://tc39.es/ecma262/)

\* \[re2c æ–‡æ¡£](https://re2c.org)

\* \[Bison æ–‡æ¡£](https://www.gnu.org/software/bison/)



> âš ï¸ æ³¨æ„ï¼šæœ¬è§£æå™¨ä¸»è¦ç”¨äºå­¦ä¹ è¯­æ³•åˆ†ææŠ€æœ¯ï¼Œä¸å»ºè®®ç”¨äºç”Ÿäº§ç¯å¢ƒã€‚



---



æ˜¯å¦å¸Œæœ›æˆ‘å°†è¿™ä¸ªä¼˜åŒ–åçš„ç‰ˆæœ¬å¯¼å‡ºä¸ºæ–°çš„ `.md` æ–‡ä»¶ä¾›ä½ ä¸‹è½½ï¼Ÿ



